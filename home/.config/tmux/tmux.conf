##### ──────────────────────────────────────────────────────────────────────────
##### 🌟 Core Behavior & UX
##### ──────────────────────────────────────────────────────────────────────────

# ⏱️ Keep escape fast but not zero (zero can break some Alt/Meta chords on laggy TTYs)
set -sg escape-time 10

# 🥁 Faster repeat timing for double-hit bindings
set -g repeat-time 300

# 🧭 vi-style keys inside tmux prompts/menus (matches copy mode)
set -g status-keys vi

# 🐭 Mouse off (you prefer keyboard-driven)
set -g mouse off

# 📋 Sync tmux copy with system clipboard (where supported)
set -g set-clipboard on

# 🛡️ Prevent accidental close when the last client exits
set -g detach-on-destroy off

# 🧾 Scrollback history
set -g history-limit 8000

# 🎯 Notify apps about focus changes (editors/REPLs react to this)
set -g focus-events on

# 🌈 Truecolor & correct terminfo to avoid washed-out colors
set -g default-terminal "tmux-256color"
set -as terminal-overrides ",*:Tc"

# 🔕 Silence the bell
set -g bell-action none


##### ──────────────────────────────────────────────────────────────────────────
##### 🎨 Theme: Oxocarbon Dark
##### ──────────────────────────────────────────────────────────────────────────

# 🟩 Status bar on, centered window list
set -g status on
set -g status-justify centre

# ⏲️ Status refresh interval (also drives #() commands)
set -g status-interval 3

# 🎨 Bar colors
set -g status-bg '#161616'
set -g status-fg '#f2f4f8'

# ⬅️ LEFT: prefix indicator ⌘ + session name + sync lock 🔒
set -g status-left '#[fg=#33b1ff,bg=#161616,bold] #{?client_prefix,⌘ ,}#S#{?pane_synchronized, 🔒,} #[fg=#161616,bg=#161616,nobold,nounderscore,noitalics]'
set -g status-left-length 30   # keep it tight to avoid wobble

# ➡️ RIGHT: cpuprincess + 24h clock
set -g status-right '%I:%M #[fg=#f2f4f8]#(~/.cargo/bin/cpuprincess)'
set -g status-right-length 60

# 🔵 Active window style/title
setw -g window-status-current-style 'fg=#161616,bg=#33b1ff,bold'
setw -g window-status-current-format ' #I:#W '

# ⚪ Inactive windows with activity star so you don’t miss output
setw -g window-status-style 'fg=#525252,bg=#161616'
setw -g window-status-format ' #{?window_activity_flag,*, }#I:#W '

# ▒ Pane borders (clean look, no top headers)
set -g pane-border-style 'fg=#393939'
set -g pane-active-border-style 'fg=#33b1ff'
set -g pane-border-status off

# 💬 Messages / prompts
set -g message-style 'bg=#161616,fg=#f2f4f8'
set -g message-command-style 'bg=#161616,fg=#33b1ff'
set -g mode-style 'bg=#393939,fg=#ffffff'

# 🏷️ Window title management:
#  - auto rename from command/path
#  - but don’t let apps rename session/window
setw -g automatic-rename on
set -g allow-rename off


##### ──────────────────────────────────────────────────────────────────────────
##### 🪟 Window & Pane Behavior
##### ──────────────────────────────────────────────────────────────────────────

# 🔢 0-based indices feel nicer
set -g base-index 0
setw -g pane-base-index 0

# 🔄 Keep window numbers compact after closes
set -g renumber-windows on

# 📐 Resize windows more aggressively when layouts/clients change
set -g aggressive-resize on

# 🖥️ Use the largest client size when multiple clients attach
set -g window-size largest

# 🔁 Broadcast typing to all panes in a window (you can toggle it; see bindings)
setw -g synchronize-panes off

# 🖼️ Allow apps (vim, less) to use alternate screen correctly
setw -g alternate-screen on


##### ──────────────────────────────────────────────────────────────────────────
##### 📋 Copy Mode (vi-like)
##### ──────────────────────────────────────────────────────────────────────────

# 📚 vi navigation in copy-mode
set -g mode-keys vi

# ✂️ Handy yanks
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel
bind -T copy-mode-vi Y send -X copy-line


##### ──────────────────────────────────────────────────────────────────────────
##### 🔎 Fuzzy Navigation with fzf-tmux (sessions / windows / panes)
##### ──────────────────────────────────────────────────────────────────────────
# REQUIREMENTS:
#   - fzf installed (fzf-tmux script available in PATH)
#   - your naming scheme like work:app, work:backend, mine:app

# 🧭 Fuzzy switch sessions
unbind C-n
bind-key C-n choose-tree -sZ


##### ──────────────────────────────────────────────────────────────────────────
##### 🧰 Environment, Clock & Misc
##### ──────────────────────────────────────────────────────────────────────────

# 🧪 Keep useful env vars when re-attaching (ssh-agent, X/Wayland)
set -g update-environment "SSH_AUTH_SOCK DISPLAY"

# 🕒 12/24 clock in the built-in clock-mode
set -g clock-mode-style 12

# 🧷 Keep tmux alive even if last session is closed
set -g exit-empty off

# 👻 No flashy visual-activity notifications
set -g visual-activity off

# 📨 Limit tmux’s internal message buffer (prevents spam buildup)
set -g message-limit 50


##### ──────────────────────────────────────────────────────────────────────────
##### ⌨️ Helpful Toggles & Rescue
##### ──────────────────────────────────────────────────────────────────────────

# 🔒 Make sure uppercase S only toggles pane sync (and doesn’t conflict with splits)
unbind S
bind-key -T prefix S setw synchronize-panes

# 🆘 Quick rescue: kill a wedged tmux server (use with care)
bind R run-shell 'tmux kill-server'
